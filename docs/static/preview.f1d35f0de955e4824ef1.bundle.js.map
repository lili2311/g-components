{"version":3,"file":"static/preview.f1d35f0de955e4824ef1.bundle.js","sources":["webpack:///./bower_components/o-comment-ui/src/javascripts/userDialogs/setPseudonymDialog.js"],"sourcesContent":["const Overlay = require('o-overlay');\nconst OverlayFormContent = require('../overlay_content_builder/OverlayFormContent.js');\nconst oCommentUtilities = require('o-comment-utilities');\n\nlet shown = false;\n\n/**\n * Shows a dialog for setting the initial pseudonym (shown when the user doesn't have a pseudonym set).\n * @param  {Object} callbacks Object with callback functions. Possible fields:\n *                                - submit: Required. Function that is called when the form is submitted\n *                                - close:  Optional. Function that is called when the dialog is closed.\n * @return {undefined}\n */\nexports.show = function (callbacks) {\n\tif (shown === false) {\n\t\tif (typeof callbacks !== 'object' || !callbacks) {\n\t\t\tthrow new Error(\"Callbacks not provided.\");\n\t\t}\n\n\t\tif (typeof callbacks.submit !== 'function') {\n\t\t\tthrow new Error(\"Submit callback not provided.\");\n\t\t}\n\n\n\t\tshown = true;\n\t\tlet inProgress = false;\n\n\t\tlet ignoreCloseEvent = false;\n\n\t\tlet form = new OverlayFormContent({\n\t\t\tmethod: 'GET',\n\t\t\taction: \"\",\n\t\t\tname: 'setpseudonym',\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'initialPseudonym'\n\t\t\t\t}\n\t\t\t],\n\t\t\tbuttons: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'submitButton',\n\t\t\t\t\tlabel: 'Save'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'cancelButton'\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\n\t\tlet overlayInstance = new Overlay(\"oCommentUi_setPseudonymDialog\", {\n\t\t\thtml: form.getContainerDomElement(),\n\t\t\theading: {\n\t\t\t\ttitle: \"Commenting Settings\"\n\t\t\t},\n\t\t\tmodal: true\n\t\t});\n\n\t\tconst onSubmitHandler = function (evt) {\n\t\t\tif (!inProgress) {\n\t\t\t\tinProgress = true;\n\t\t\t\tform.disableButtons();\n\n\t\t\t\tconst formData = form.serialize();\n\n\t\t\t\tcallbacks.submit(formData, function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tform.showError(err);\n\n\t\t\t\t\t\tform.enableButtons();\n\t\t\t\t\t\tinProgress = false;\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tshown = false;\n\n\t\t\t\t\tignoreCloseEvent = true;\n\t\t\t\t\toverlayInstance.close();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (evt.preventDefault) {\n\t\t\t\tevt.preventDefault();\n\t\t\t} else {\n\t\t\t\tevt.returnValue = false;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t\tform.getFormDomElement().addEventListener('submit', onSubmitHandler);\n\n\n\t\tconst onCloseInternalHandler = function () {\n\t\t\tshown = false;\n\n\t\t\tif (form) {\n\t\t\t\tform.getFormDomElement().removeEventListener('submit', onSubmitHandler);\n\t\t\t\tform.getContainerDomElement().removeEventListener('oCommentUi.form.cancel', onCancelHandler);\n\t\t\t\tform.destroy();\n\t\t\t\tform = null;\n\t\t\t}\n\n\t\t\tif (overlayInstance) {\n\t\t\t\toverlayInstance.wrapper.removeEventListener('oOverlay.destroy', onCloseInternalHandler);\n\t\t\t\toverlayInstance = null;\n\t\t\t}\n\n\t\t\tif (!ignoreCloseEvent) {\n\t\t\t\tif (typeof callbacks.close === 'function') {\n\t\t\t\t\tcallbacks.close();\n\t\t\t\t}\n\n\t\t\t\tif (!inProgress) {\n\t\t\t\t\toCommentUtilities.logger.log('pseudonym refused');\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\toverlayInstance.open();\n\n\t\tconst onCancelHandler = function () {\n\t\t\toverlayInstance.close();\n\t\t};\n\t\tform.getContainerDomElement().addEventListener('oCommentUi.form.cancel', onCancelHandler);\n\n\t\toverlayInstance.wrapper.addEventListener('oOverlay.destroy', onCloseInternalHandler);\n\t}\n};\n"],"mappings":"AAAA","sourceRoot":""}